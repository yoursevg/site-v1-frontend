(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[120],{3673:function(e,t,a){Promise.resolve().then(a.bind(a,1525))},1525:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return C}});var r=a(7437),s=a(2265),n=a(7907),o=a(5671),l=a(703),i=a(8062),c=a(3879),d=a(8025),u=a(2169),f=a(575);let h=s.createContext(null);function p(){let e=s.useContext(h);if(!e)throw Error("useCarousel must be used within a <Carousel />");return e}let m=s.forwardRef((e,t)=>{let{orientation:a="horizontal",opts:n,setApi:o,plugins:l,className:c,children:d,...f}=e,[p,m]=(0,i.Z)({...n,axis:"horizontal"===a?"x":"y"},l),[x,g]=s.useState(!1),[v,N]=s.useState(!1),b=s.useCallback(e=>{e&&(g(e.canScrollPrev()),N(e.canScrollNext()))},[]),j=s.useCallback(()=>{null==m||m.scrollPrev()},[m]),y=s.useCallback(()=>{null==m||m.scrollNext()},[m]),w=s.useCallback(e=>{"ArrowLeft"===e.key?(e.preventDefault(),j()):"ArrowRight"===e.key&&(e.preventDefault(),y())},[j,y]);return s.useEffect(()=>{m&&o&&o(m)},[m,o]),s.useEffect(()=>{if(m)return b(m),m.on("reInit",b),m.on("select",b),()=>{null==m||m.off("select",b)}},[m,b]),(0,r.jsx)(h.Provider,{value:{carouselRef:p,api:m,opts:n,orientation:a||((null==n?void 0:n.axis)==="y"?"vertical":"horizontal"),scrollPrev:j,scrollNext:y,canScrollPrev:x,canScrollNext:v},children:(0,r.jsx)("div",{ref:t,onKeyDownCapture:w,className:(0,u.cn)("relative",c),role:"region","aria-roledescription":"carousel",...f,children:d})})});m.displayName="Carousel";let x=s.forwardRef((e,t)=>{let{className:a,...s}=e,{carouselRef:n,orientation:o}=p();return(0,r.jsx)("div",{ref:n,className:"overflow-hidden",children:(0,r.jsx)("div",{ref:t,className:(0,u.cn)("flex","horizontal"===o?"-ml-4":"-mt-4 flex-col",a),...s})})});x.displayName="CarouselContent";let g=s.forwardRef((e,t)=>{let{className:a,...s}=e,{orientation:n}=p();return(0,r.jsx)("div",{ref:t,role:"group","aria-roledescription":"slide",className:(0,u.cn)("min-w-0 shrink-0 grow-0 basis-full","horizontal"===n?"pl-4":"pt-4",a),...s})});g.displayName="CarouselItem";let v=s.forwardRef((e,t)=>{let{className:a,variant:s="outline",size:n="icon",...o}=e,{orientation:l,scrollPrev:i,canScrollPrev:d}=p();return(0,r.jsxs)(f.z,{ref:t,variant:s,size:n,className:(0,u.cn)("absolute  h-8 w-8 rounded-full","horizontal"===l?"-left-9 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",a),disabled:!d,onClick:i,...o,children:[(0,r.jsx)(c.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Previous slide"})]})});v.displayName="CarouselPrevious";let N=s.forwardRef((e,t)=>{let{className:a,variant:s="outline",size:n="icon",...o}=e,{orientation:l,scrollNext:i,canScrollNext:c}=p();return(0,r.jsxs)(f.z,{ref:t,variant:s,size:n,className:(0,u.cn)("absolute h-8 w-8 rounded-full","horizontal"===l?"-right-9 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",a),disabled:!c,onClick:i,...o,children:[(0,r.jsx)(d.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Next slide"})]})});N.displayName="CarouselNext";var b=a(4811),j=a(8209),y=a(5782),w=function(e){let{userId:t,sellerId:a}=e,[n,o]=(0,s.useState)([]),[l,i]=(0,s.useState)(""),[c,d]=(0,s.useState)(null),{getToken:u}=(0,y.aC)();(0,s.useEffect)(()=>{let e=async()=>{let e=await u(),r=(0,j.ZP)("http://localhost:1337",{auth:{strategy:"jwt",token:e}});return r.on("connect",async()=>{let s=await b.Z.findOrCreateRoom(t,a,e);d(s.id),r.emit("join-room",s.id);let n=await b.Z.getMessages(s.id,e);o(null==n?void 0:n.data),r.on("new-message",e=>{o(t=>[...t,e])})}),()=>{r.close()}};t&&a&&e()},[t,a,u]);let f=async()=>{l&&c&&(await u(),i(""))};return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{children:n&&n.length>0?n.map((e,t)=>(0,r.jsx)("div",{children:e.content},t)):(0,r.jsx)("div",{className:"no-messages",children:"No messages yet. Start the conversation!"})}),(0,r.jsx)("input",{type:"text",value:l,onChange:e=>i(e.target.value)}),(0,r.jsx)("button",{onClick:f,children:"Отправить"})]})},C=function(){var e;let[t,a]=(0,s.useState)(null),[i,c]=(0,s.useState)(""),[d,u]=(0,s.useState)(NaN),f=(0,n.useSearchParams)().get("postId"),{isLoaded:h,isSignedIn:p,user:j}=(0,y.aF)();return((0,s.useEffect)(()=>{f&&h&&p&&j&&(b.Z.getPostByPostId(f).then(e=>{var t;a(null==e?void 0:e.data.data.attributes),c(null==e?void 0:null===(t=e.data.data.attributes)||void 0===t?void 0:t.images.data[0].attributes.url)}),b.Z.getUserIdByIdentificator(j.id).then(e=>{u(null==e?void 0:e.data[0].id)}))},[f,h,p,j]),!t||Number.isNaN(d))?(0,r.jsx)(o.Zb,{children:(0,r.jsx)("div",{className:"h-[80vh] w-full bg-slate-200 rounded-lg animate-pulse"})}):(0,r.jsxs)(o.Zb,{className:"px-3 py-8",children:[(0,r.jsx)(o.Ol,{className:"pt-0",children:(0,r.jsx)(o.ll,{children:null==t?void 0:t.title})}),(0,r.jsxs)(o.aY,{className:"flex justify-between",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,r.jsxs)("div",{className:"photos flex flex-col gap-2",children:[(0,r.jsx)(l.default,{src:i,width:600,height:500,alt:"photo",className:"rounded-3xl"}),(0,r.jsx)("div",{className:"flex px-8",children:(0,r.jsxs)(m,{opts:{align:"start"},className:"w-full max-w-sm",children:[(0,r.jsx)(x,{className:"items-center",children:null==t?void 0:t.images.data.map((e,t)=>(0,r.jsx)(g,{className:"md:basis-1/2 lg:basis-1/3",children:(0,r.jsx)("div",{className:"px-0",children:(0,r.jsx)(o.Zb,{className:"cursor-pointer",children:(0,r.jsx)(o.aY,{className:"flex aspect-auto items-center justify-center p-0",children:(0,r.jsx)(l.default,{src:e.attributes.formats.thumbnail.url,width:120,height:100,alt:"photo",className:"rounded-md",onClick:()=>c(e.attributes.url)})})})})},t))}),(0,r.jsx)(v,{}),(0,r.jsx)(N,{})]})})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)("span",{className:"font-bold",children:"Адрес"}),(0,r.jsx)("span",{children:t.location})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)("span",{className:"font-bold",children:"Характеристика"}),(0,r.jsx)("span",{children:t.condition})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)("span",{className:"font-bold",children:"Остаток"}),(0,r.jsx)("span",{children:t.stock})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)("span",{className:"font-bold",children:"Описание"}),(0,r.jsx)("span",{children:t.description})]})]})]}),(0,r.jsx)("div",{className:"w-[300px] border",children:d&&t&&(0,r.jsx)(w,{userId:d,sellerId:null===(e=t.author)||void 0===e?void 0:e.data.id})})]})]})}},4811:function(e,t,a){"use strict";let r=a(7908).Z.create({baseURL:"http://localhost:1337/api"}),s=()=>r.get("posts?populate=*&sort=id").catch(e=>console.error("Ошибка при получении объявлений:",e)),n=async e=>{if(""===e)return s();try{return(await r.post("/graphql",{query:"\n      query SearchPosts($searchTerm: String!) {\n        search(query: $searchTerm) {\n          posts {\n            data {\n              id\n              attributes {\n                title\n                createdAt\n                price\n                stock\n                location\n                description\n                condition\n                category {\n                    data {\n                        attributes {\n                            name\n                        }\n                    }\n                }\n                author {\n                  data {\n                    attributes {\n                      username\n                      first_name\n                      last_name\n                      createdAt\n                      identificator\n                      profile_image_url\n                    }\n                  }\n                }\n                images {\n                  data {\n                    attributes {\n                      url\n                      formats\n                    }\n                  }\n                }\n                users_favorites {\n                  data {\n                    attributes {\n                      identificator\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    ",variables:{searchTerm:e}},{baseURL:"http://localhost:1337"})).data.data.search}catch(e){console.error("Ошибка при попытке поиска объявлений:",e)}},o=async(e,t)=>{try{let a;let s=await r.get("/users?filters[identificator][$eq]=".concat(t));console.log(s);let n=s.data.length>0?s.data[0].id:null;if(!n){console.log("Пользователь не найден");return}let o=(await r.get("/posts/".concat(e,"?populate=users_favorites"))).data.data.attributes.users_favorites.data;a=o.some(e=>e.id===n)?o.filter(e=>e.id!==n):[...o,{id:n}];let l=await r.put("/posts/".concat(e),{data:{users_favorites:a}});console.log("Изменения в избранных сохранены",l)}catch(e){console.error("Ошибка при обновлении списка избранных:",e)}},l=async(e,t,a)=>{try{let s=await r.get("/rooms?filters[$and][0][users]=".concat(e,"&filters[$and][1][users]=").concat(t),{headers:{Authorization:"Bearer ".concat(a)}});if(s.data.data.length>0)return s.data.data[0];return(s=await r.post("/rooms",{data:{users:[e,t]}})).data.data}catch(e){throw console.error("Ошибка при попытке найти или создать комнату:",e),e}};t.Z={getPosts:s,getPostByPostId:e=>r.get("posts/".concat(e,"?populate=*")).catch(e=>console.error("Ошибка при получении объявления:",e)),getCategories:()=>r.get("categories?populate=*&sort=id").catch(e=>console.error("Ошибка при получении категорий:",e)),getPostsByUserId:e=>r.get("posts?populate=*&filters[author][identificator][$eq]=".concat(e)).catch(e=>console.error("Ошибка при получении объявлений:",e)),uploadPhoto:e=>{let t=new FormData;return t.append("files",e),r.post("upload",t,{headers:{"Content-Type":"multipart/form-data"}})},createPost:e=>r.post("posts",{data:{...e}}).catch(e=>console.error("Ошибка при создании объявления:",e)),deletePhoto:e=>r.delete("upload/files/".concat(e)).catch(e=>console.error("Ошибка при получении объявлений:",e)),getFavoritesPostsByUserId:e=>r.get("posts?populate=*&filters[users_favorites][identificator][$eq]=".concat(e)).catch(e=>console.error("Ошибка при получении объявлений:",e)),getPostsByCategory:e=>r.get("posts?populate=*&filters[category][name][$eq]=".concat(e)).catch(e=>console.error("Ошибка при получении объявлений:",e)),getUserIdByIdentificator:e=>r.get("/users?populate=*&filters[identificator][$eq]=".concat(e)).catch(e=>console.error("Ошибка при получении пользователя:",e)),getPostsBySearch:n,updateFavoritesByUserAndPostId:o,findOrCreateRoom:l,getMessages:(e,t)=>r.get("/messages?filters[room]=".concat(e),{headers:{Authorization:"Bearer ".concat(t)}}).catch(e=>console.error("Ошибка при получении сообщений:",e)),sendMessage:e=>{let{roomId:t,content:a,senderId:s,token:n}=e;return r.post("/messages",{data:{room:t,content:a,sender:s}},{headers:{Authorization:"Bearer ".concat(n)}}).then(e=>e.data).catch(e=>console.error("Ошибка при отправке сообщения:",e))}}},575:function(e,t,a){"use strict";a.d(t,{d:function(){return i},z:function(){return c}});var r=a(7437),s=a(2265),n=a(9143),o=a(7742),l=a(2169);let i=(0,o.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:a,variant:s,size:o,asChild:c=!1,...d}=e,u=c?n.g7:"button";return(0,r.jsx)(u,{className:(0,l.cn)(i({variant:s,size:o,className:a})),ref:t,...d})});c.displayName="Button"},5671:function(e,t,a){"use strict";a.d(t,{Ol:function(){return l},Zb:function(){return o},aY:function(){return c},ll:function(){return i}});var r=a(7437),s=a(2265),n=a(2169);let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...s})});o.displayName="Card";let l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",a),...s})});l.displayName="CardHeader";let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",a),...s})});i.displayName="CardTitle",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...s})}).displayName="CardDescription";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("px-6 pt-0",a),...s})});c.displayName="CardContent",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center px-6 pt-0",a),...s})}).displayName="CardFooter"},2169:function(e,t,a){"use strict";a.d(t,{cn:function(){return n}});var r=a(3167),s=a(1367);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.m6)((0,r.W)(t))}}},function(e){e.O(0,[554,150,772,908,819,971,69,744],function(){return e(e.s=3673)}),_N_E=e.O()}]);