(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[286],{2431:function(){},8027:function(e,t,a){"use strict";a.d(t,{Z:function(){return w}});var r=a(7437),s=a(2265),o=a(5671),n=a(703),l=a(5879),i=a(2457),c=a(7307),d=a(5211),u=a(5808),f=a(8792),m=a(8734),h=a(5782),p=a(4811),x=a(8152),v=a(2169);let g=x.zt,j=x.fC,b=x.xz,N=s.forwardRef((e,t)=>{let{className:a,sideOffset:s=4,...o}=e;return(0,r.jsx)(x.VY,{ref:t,sideOffset:s,className:(0,v.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...o})});N.displayName=x.VY.displayName;var y=a(3310),w=function(e){var t,a,x,v,w,C,_,A,k,z,R,Z,q;let{post:I}=e,{isLoaded:P,user:B}=(0,h.aF)(),[$,F]=(0,s.useState)(!1);(0,s.useEffect)(()=>{var e,t;F(!1),B&&(null===(t=I.attributes.users_favorites)||void 0===t?void 0:null===(e=t.data[0])||void 0===e?void 0:e.attributes.identificator)===(null==B?void 0:B.id)&&F(!0)},[B,I]);let{TimeAgo:U}=(0,m.I)(),Y=async(e,t)=>{try{let a=await p.Z.updateFavoritesByUserAndPostId(e,t);console.log(a),F(!$)}catch(e){console.error(e)}};return P?(0,r.jsx)(o.Zb,{className:"w-full rounded-xl h-[200px] transition duration-300 ease-in-out hover:shadow-lg hover:bg-opacity-50",children:(0,r.jsxs)(o.aY,{className:"flex justify-between px-0 h-full",children:[(0,r.jsxs)("div",{className:"flex h-full",children:[(0,r.jsx)("div",{className:"h-full relative w-64",children:(0,r.jsx)(n.default,{className:"rounded-l-xl",src:null===(a=I.attributes.images)||void 0===a?void 0:null===(t=a.data[0])||void 0===t?void 0:t.attributes.url,alt:"photo",objectFit:"cover",layout:"fill"})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)(f.default,{href:"/posts?postId=".concat(I.id),children:(0,r.jsx)(o.ll,{className:"my-4 w-[350px]",children:(0,r.jsx)(g,{children:(0,r.jsxs)(j,{children:[(0,r.jsx)(b,{children:(q=I.attributes.title).length>25?q.substring(0,25)+"...":q}),(0,r.jsx)(N,{children:(0,r.jsx)("p",{children:I.attributes.title})})]})})})}),(0,r.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,r.jsxs)("span",{className:"font-bold text-black text-lg",children:[I.attributes.price,"₽"]}),(0,r.jsxs)("p",{children:[I.attributes.stock," шт. в наличии"]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(i.Z,{size:15})," ",I.attributes.location]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(c.Z,{size:15})," ",(0,r.jsx)(U,{date:I.attributes.createdAt,locale:"ru"})]})]})]})]}),(0,r.jsxs)("div",{className:"flex flex-col items-end justify-between p-5",children:[(0,r.jsx)(y.CH,{children:(0,r.jsx)(d.Z,{className:"cursor-pointer ".concat($&&"fill-black"),onClick:()=>Y(I.id,null==B?void 0:B.id)})}),(0,r.jsxs)("div",{className:"flex gap-2 mt-auto items-center",children:[(0,r.jsxs)(u.Avatar,{className:"border",children:[(0,r.jsx)(u.AvatarImage,{src:null===(w=I.attributes.author)||void 0===w?void 0:null===(v=w.data)||void 0===v?void 0:null===(x=v.attributes)||void 0===x?void 0:x.profile_image_url}),(0,r.jsx)(u.AvatarFallback,{children:"AV"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-black",children:null!==(Z=null===(_=I.attributes.author)||void 0===_?void 0:null===(C=_.data)||void 0===C?void 0:C.attributes.first_name)&&void 0!==Z?Z:null===(k=I.attributes.author)||void 0===k?void 0:null===(A=k.data)||void 0===A?void 0:A.attributes.username}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(e=>{let{rating:t}=e,a=[];for(let e=1;e<=5;e++)e<=Math.round(t)?a.push((0,r.jsx)(l.Z,{size:12,className:"fill-black"},e)):a.push((0,r.jsx)(l.Z,{size:12},e));return(0,r.jsx)("div",{className:"flex",children:a})},{rating:4}),(0,r.jsx)("span",{className:"text-sm",children:"13300"})]}),(0,r.jsxs)("span",{className:"text-sm",children:["зарегистрирован:","\n",(0,r.jsx)(U,{date:null===(R=I.attributes.author)||void 0===R?void 0:null===(z=R.data)||void 0===z?void 0:z.attributes.createdAt,locale:"ru"})]})]})]})]})]})}):(0,r.jsx)("div",{children:"Loading..."})}},4811:function(e,t,a){"use strict";let r=a(7908).Z.create({baseURL:"http://localhost:1337/api"}),s=()=>r.get("posts?populate=*&sort=id").catch(e=>console.error("Ошибка при получении объявлений:",e)),o=async e=>{if(""===e)return s();try{return(await r.post("/graphql",{query:"\n      query SearchPosts($searchTerm: String!) {\n        search(query: $searchTerm) {\n          posts {\n            data {\n              id\n              attributes {\n                title\n                createdAt\n                price\n                stock\n                location\n                description\n                condition\n                category {\n                    data {\n                        attributes {\n                            name\n                        }\n                    }\n                }\n                author {\n                  data {\n                    attributes {\n                      username\n                      first_name\n                      last_name\n                      createdAt\n                      identificator\n                      profile_image_url\n                    }\n                  }\n                }\n                images {\n                  data {\n                    attributes {\n                      url\n                      formats\n                    }\n                  }\n                }\n                users_favorites {\n                  data {\n                    attributes {\n                      identificator\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    ",variables:{searchTerm:e}},{baseURL:"http://localhost:1337"})).data.data.search}catch(e){console.error("Ошибка при попытке поиска объявлений:",e)}},n=async(e,t)=>{try{let a;let s=await r.get("/users?filters[identificator][$eq]=".concat(t));console.log(s);let o=s.data.length>0?s.data[0].id:null;if(!o){console.log("Пользователь не найден");return}let n=(await r.get("/posts/".concat(e,"?populate=users_favorites"))).data.data.attributes.users_favorites.data;a=n.some(e=>e.id===o)?n.filter(e=>e.id!==o):[...n,{id:o}];let l=await r.put("/posts/".concat(e),{data:{users_favorites:a}});console.log("Изменения в избранных сохранены",l)}catch(e){console.error("Ошибка при обновлении списка избранных:",e)}},l=async(e,t,a)=>{try{let s=await r.get("/rooms?filters[$and][0][users]=".concat(e,"&filters[$and][1][users]=").concat(t),{headers:{Authorization:"Bearer ".concat(a)}});if(s.data.data.length>0)return s.data.data[0];return(s=await r.post("/rooms",{data:{users:[e,t]}})).data.data}catch(e){throw console.error("Ошибка при попытке найти или создать комнату:",e),e}};t.Z={getPosts:s,getPostByPostId:e=>r.get("posts/".concat(e,"?populate=*")).catch(e=>console.error("Ошибка при получении объявления:",e)),getCategories:()=>r.get("categories?populate=*&sort=id").catch(e=>console.error("Ошибка при получении категорий:",e)),getPostsByUserId:e=>r.get("posts?populate=*&filters[author][identificator][$eq]=".concat(e)).catch(e=>console.error("Ошибка при получении объявлений:",e)),uploadPhoto:e=>{let t=new FormData;return t.append("files",e),r.post("upload",t,{headers:{"Content-Type":"multipart/form-data"}})},createPost:e=>r.post("posts",{data:{...e}}).catch(e=>console.error("Ошибка при создании объявления:",e)),deletePhoto:e=>r.delete("upload/files/".concat(e)).catch(e=>console.error("Ошибка при получении объявлений:",e)),getFavoritesPostsByUserId:e=>r.get("posts?populate=*&filters[users_favorites][identificator][$eq]=".concat(e)).catch(e=>console.error("Ошибка при получении объявлений:",e)),getPostsByCategory:e=>r.get("posts?populate=*&filters[category][name][$eq]=".concat(e)).catch(e=>console.error("Ошибка при получении объявлений:",e)),getUserIdByIdentificator:e=>r.get("/users?populate=*&filters[identificator][$eq]=".concat(e)).catch(e=>console.error("Ошибка при получении пользователя:",e)),getPostsBySearch:o,updateFavoritesByUserAndPostId:n,findOrCreateRoom:l,getMessages:(e,t)=>r.get("/messages?filters[room]=".concat(e),{headers:{Authorization:"Bearer ".concat(t)}}).catch(e=>console.error("Ошибка при получении сообщений:",e)),sendMessage:e=>{let{roomId:t,content:a,senderId:s,token:o}=e;return r.post("/messages",{data:{room:t,content:a,sender:s}},{headers:{Authorization:"Bearer ".concat(o)}}).then(e=>e.data).catch(e=>console.error("Ошибка при отправке сообщения:",e))}}},5808:function(e,t,a){"use strict";a.r(t),a.d(t,{Avatar:function(){return l},AvatarFallback:function(){return c},AvatarImage:function(){return i}});var r=a(7437),s=a(2265),o=a(2178),n=a(2169);let l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(o.fC,{ref:t,className:(0,n.cn)("relative flex h-14 w-14 shrink-0 overflow-hidden rounded-full",a),...s})});l.displayName=o.fC.displayName;let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(o.Ee,{ref:t,className:(0,n.cn)("aspect-square h-full w-full",a),...s})});i.displayName=o.Ee.displayName;let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(o.NY,{ref:t,className:(0,n.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...s})});c.displayName=o.NY.displayName},5671:function(e,t,a){"use strict";a.d(t,{Ol:function(){return l},Zb:function(){return n},aY:function(){return c},ll:function(){return i}});var r=a(7437),s=a(2265),o=a(2169);let n=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...s})});n.displayName="Card";let l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",a),...s})});l.displayName="CardHeader";let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("h3",{ref:t,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",a),...s})});i.displayName="CardTitle",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("p",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",a),...s})}).displayName="CardDescription";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("px-6 pt-0",a),...s})});c.displayName="CardContent",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center px-6 pt-0",a),...s})}).displayName="CardFooter"},2169:function(e,t,a){"use strict";a.d(t,{cn:function(){return o}});var r=a(3167),s=a(1367);function o(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.m6)((0,r.W)(t))}}}]);